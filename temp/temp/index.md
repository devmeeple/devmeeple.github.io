---
title: "집계와 서브쿼리"
date: 2024-07-14 11:01:27
tags:
  - Database
series: 
---

## 집계 함수

집계 함수는 집합을 계산하고 단일 값을 반환하는 함수다. 일반적인 함수는 인수로 하나의 값을 지정한다. 하지만 집계 함수는 인수로 집합을 지정한다. 그래서 '집합 함수'라고도 한다.
일반적인 함수는 하나의 행에 대해 하나의 값을 반환한다. 반면 집계 함수는 '집합으로부터 하나의 값'을 반환한다.

앞서 강조했듯이 NULL 값을 주의해야 한다. 집계 함수는 집합 안에 NULL 값이 있다면 제외하고 계산한다. 주로 COUNT 함수와 함께 사용한다.

### DISTINCT

중복된 값을 제거할 때 사용한다.

### COUNT

```sql
COUNT(column_name);
```

COUNT 함수는 행 개수를 구할 때 사용한다.

### SUM

```sql
SUM(column_name);
```

SUM 함수는 총합을 반환한다. SUM 함수에 가능한 인자는 숫자형이다. 이 외에 문자형, 날짜와 시간형 같은 데이터 타입은 허용하지 않는다.

### AVG

```sql
AVG(column_name);
```

AVG 함수는 평균값을 반환한다. SUM 함수처럼 인자로 숫자형만 사용할 수 있다.

'앞서 NULL 값을 주의해서 다뤄야 한다'고 강조했다. 특히 평균을 구할 때 더욱 신경써야 하는데, 예시 ~

```sql
SELECT AVG(COALESCE(quantity, 0)) AS avgnu110
FROM sample51;
```

이렇게 COALESCE 함수로 NULL 값을 0으로 대신하고 처리할 수 있다.

### MIN

```sql
MIN(column_name);
```

MIN 함수는 최솟값을 반환한다. 인자로 숫자형 외에도 문자형, 날짜시간형등을 지정할 수 있다.

### MAX

```sql
MAX(column_name);
```

MAX 함수는 최댓값을 반환한다.

### 그룹화 - GROUP BY

GROUP BY는 집계 함수에 인자로 사용하는 집합을 그룹화 할 때 사용한다. 지정된 열의 값이 같은 행이 하나의 그룹으로 묶인다. GROUP BY는 특정 단위를 집계할 때 자주 사용한다. 예를들어

GROUP BY를 사용할 때 주의할 점은 지정한 열 이외의 열은 집계 함수를 사용하지 않고 SELECT 절에 사용할 수 없다.

### 조건 - HAVING

집계 함수는 WHERE 절에 사용할 수 없다. HAVING을 사용해서 집계된 결과를 조건에 맞게 분류할 수 있다.

조건을 다루는 WHERE와 HAVING은 어떤 관계를 가질까? **WHERE 절은 집계되지 않은 데이터의 조건이고, HAVING은 집계된 데이터의 조건이다.**

> WHERE -> GROUP BY -> HAVING -> SELECT -> ORDER BY

## 서브쿼리(Subquery)

- 정의
- 서브쿼리의 다양한 사용, 패턴

서브쿼리란 다른 쿼리 내부에 정의된 SELECT 절이다. 서브쿼리는 반든시 괄호로 감싸져 있어야 한다. 서브쿼리를 포함하는 쿼리를 외부쿼리(outer query), 서브쿼리를 내부쿼리(inner query)라고 한다.

서브쿼리는 SELECT, FROM, WHERE 절 등 다양한 절에서 사용가능하다. 특히 WHERE 절에 주로 사용한다.

### 스칼라(Scalar)

- 서브쿼리 패턴(하나의 값을 반환, 복수의 행을 반환하지만 열은 하나, 하나의 행을 반환하지만 열이 복수, 복수의 행, 복수의 열)

데이터베이스에서 하나의 값을 '스칼라 값'이라고 이야기한다. 스칼라 값이 특별한 취급을 받는 이유는 서브쿼리에서 사용하기 쉽기 때문이다.

## 상관 서브쿼리(Correlated Subquery)

부모 명령과 자식인 서브쿼리가 관계를 맺는 것을 '상관 서브쿼리'라고 한다. 서브쿼리는 단독 쿼리로 실행가능하다. 하지만 상관 서브쿼리는 단독 실행할 수 없다. 

### EXISTS

데이터가 존재하는지 여부를 판별한다.

### IN

값이 존재하는지 여부를 확인한다. 'A 또는(OR) B'와 같은 조건식을 지정할 때 사용한다. 값을 여러개 지정할 때 조건식이 깔끔해져 가독성을 높인다.

<참고 자료>

**<참고자료>**

1. 『SQL 첫걸음』(아사이 아츠시, 한빛미디어, 2015)
2. [TechOnTheNet 'SQL Tutorial'](https://www.techonthenet.com/index.php)
3. [위키독스 'AI가 알려주는 SQL - 아직 AI가 알아서 못하는 DB 관리'](https://wikidocs.net/book/13790)
